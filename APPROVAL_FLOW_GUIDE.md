# å®¡æ‰¹æµç®¡ç†ç³»ç»Ÿå®ç°æŒ‡å—

## æ¦‚è¿°

å®¡æ‰¹æµç®¡ç†ç³»ç»ŸåŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼šå®¡æ‰¹æµç±»å‹å’Œå®¡æ‰¹æµæ¨¡æ¿ã€‚åç«¯APIå·²å®Œæˆï¼Œå‰ç«¯éƒ¨åˆ†æ­£åœ¨å®ç°ä¸­ã€‚

## æ•°æ®åº“è¡¨è®¾è®¡

### 1. approval_flow_typeï¼ˆå®¡æ‰¹æµç±»å‹ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä¸»é”®ID |
| name | varchar(100) | ç±»å‹åç§° |
| status | tinyint | çŠ¶æ€ï¼š0-å¯ç”¨ï¼Œ1-ç¦ç”¨ |

**å†…ç½®æ•°æ®ï¼š**
- æŒ½å•ï¼ˆstatus=0ï¼‰
- é€€è´¹ï¼ˆstatus=0ï¼‰

### 2. approval_flow_templateï¼ˆå®¡æ‰¹æµæ¨¡æ¿ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä¸»é”®ID |
| name | varchar(200) | æ¨¡æ¿åç§° |
| approval_flow_type_id | int | å®¡æ‰¹æµç±»å‹ID |
| creator | varchar(100) | åˆ›å»ºäºº |
| status | tinyint | çŠ¶æ€ï¼š0-å¯ç”¨ï¼Œ1-ç¦ç”¨ |

### 3. approval_flow_template_nodeï¼ˆæ¨¡æ¿èŠ‚ç‚¹ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä¸»é”®ID |
| template_id | int | æ¨¡æ¿ID |
| name | varchar(100) | èŠ‚ç‚¹åç§° |
| sort | int | èŠ‚ç‚¹æ’åº |
| type | tinyint | å®¡æ‰¹ç±»å‹ï¼š0-ä¼šç­¾ï¼Œ1-æˆ–ç­¾ |

### 4. approval_node_useraccountï¼ˆèŠ‚ç‚¹å®¡æ‰¹äººï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä¸»é”®ID |
| node_id | int | èŠ‚ç‚¹ID |
| useraccount_id | int | ç”¨æˆ·è´¦å·ID |

### 5. approval_copy_useraccountï¼ˆæ¨¡æ¿æŠ„é€äººï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä¸»é”®ID |
| approval_flow_template_id | int | æ¨¡æ¿ID |
| useraccount_id | int | ç”¨æˆ·è´¦å·ID |

## åç«¯APIæ¥å£

### å®¡æ‰¹æµç±»å‹

#### 1. è·å–å®¡æ‰¹æµç±»å‹åˆ—è¡¨
**æ¥å£**: `GET /api/approval-flow-types`

**æŸ¥è¯¢å‚æ•°**:
- `id` - ç±»å‹IDï¼ˆå¯é€‰ï¼Œç²¾å‡†æœç´¢ï¼‰
- `name` - ç±»å‹åç§°ï¼ˆå¯é€‰ï¼Œç²¾å‡†æœç´¢ï¼‰
- `status` - çŠ¶æ€ï¼ˆå¯é€‰ï¼Œ0æˆ–1ï¼‰

**è¿”å›æ•°æ®**:
```json
{
  "approval_flow_types": [
    {
      "id": 1,
      "name": "æŒ½å•",
      "status": 0,
      "create_time": "2026-01-14 10:00:00",
      "update_time": "2026-01-14 10:00:00"
    }
  ]
}
```

#### 2. æ›´æ–°å®¡æ‰¹æµç±»å‹çŠ¶æ€
**æ¥å£**: `PUT /api/approval-flow-types/<type_id>/status`

**è¯·æ±‚å‚æ•°**:
```json
{
  "status": 0
}
```

### å®¡æ‰¹æµæ¨¡æ¿

#### 1. è·å–å®¡æ‰¹æµæ¨¡æ¿åˆ—è¡¨
**æ¥å£**: `GET /api/approval-flow-templates`

**æŸ¥è¯¢å‚æ•°**:
- `id` - æ¨¡æ¿IDï¼ˆå¯é€‰ï¼Œç²¾å‡†æœç´¢ï¼‰
- `approval_flow_type_id` - å®¡æ‰¹æµç±»å‹IDï¼ˆå¯é€‰ï¼‰
- `name` - æ¨¡æ¿åç§°ï¼ˆå¯é€‰ï¼Œæ¨¡ç³Šæœç´¢ï¼‰
- `status` - çŠ¶æ€ï¼ˆå¯é€‰ï¼Œ0æˆ–1ï¼‰

**è¿”å›æ•°æ®**:
```json
{
  "approval_flow_templates": [
    {
      "id": 1,
      "name": "é€€è´¹å®¡æ‰¹æµç¨‹",
      "approval_flow_type_id": 2,
      "flow_type_name": "é€€è´¹",
      "creator": "admin",
      "status": 0,
      "create_time": "2026-01-14 10:00:00"
    }
  ]
}
```

#### 2. è·å–å®¡æ‰¹æµæ¨¡æ¿è¯¦æƒ…
**æ¥å£**: `GET /api/approval-flow-templates/<template_id>`

**è¿”å›æ•°æ®**:
```json
{
  "template": {
    "id": 1,
    "name": "é€€è´¹å®¡æ‰¹æµç¨‹",
    "approval_flow_type_id": 2,
    "flow_type_name": "é€€è´¹",
    "creator": "admin",
    "status": 0
  },
  "nodes": [
    {
      "id": 1,
      "template_id": 1,
      "name": "éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹",
      "sort": 1,
      "type": 0,
      "approvers": [
        {"useraccount_id": 1, "username": "å¼ ä¸‰"},
        {"useraccount_id": 2, "username": "æå››"}
      ]
    }
  ],
  "copy_users": [
    {"useraccount_id": 3, "username": "ç‹äº”"}
  ]
}
```

#### 3. æ–°å¢å®¡æ‰¹æµæ¨¡æ¿
**æ¥å£**: `POST /api/approval-flow-templates`

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "é€€è´¹å®¡æ‰¹æµç¨‹",
  "approval_flow_type_id": 2,
  "nodes": [
    {
      "name": "éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹",
      "type": 0,
      "approvers": [1, 2]
    },
    {
      "name": "è´¢åŠ¡å®¡æ‰¹",
      "type": 1,
      "approvers": [3]
    }
  ],
  "copy_users": [4, 5]
}
```

**è¯´æ˜**:
- `nodes.type`: 0-ä¼šç­¾ï¼ˆæ‰€æœ‰äººéƒ½è¦å®¡æ‰¹ï¼‰ï¼Œ1-æˆ–ç­¾ï¼ˆä»»æ„ä¸€äººå®¡æ‰¹å³å¯ï¼‰
- `nodes.approvers`: å®¡æ‰¹äººå‘˜IDæ•°ç»„ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ª
- `copy_users`: æŠ„é€äººå‘˜IDæ•°ç»„ï¼Œå¯ä»¥ä¸ºç©º
- æ–°åˆ›å»ºçš„æ¨¡æ¿é»˜è®¤çŠ¶æ€ä¸º1ï¼ˆç¦ç”¨ï¼‰

#### 4. æ›´æ–°å®¡æ‰¹æµæ¨¡æ¿çŠ¶æ€
**æ¥å£**: `PUT /api/approval-flow-templates/<template_id>/status`

**è¯·æ±‚å‚æ•°**:
```json
{
  "status": 0
}
```

**é‡è¦è§„åˆ™**:
- å¯ç”¨æ¨¡æ¿æ—¶ï¼ˆstatus=0ï¼‰ï¼Œä¼šè‡ªåŠ¨å°†åŒç±»å‹çš„å…¶ä»–å¯ç”¨æ¨¡æ¿ç¦ç”¨
- åŒç±»å‹çš„å®¡æ‰¹æµæ¨¡æ¿ä»…å¯ç”Ÿæ•ˆä¸€ä¸ª

## å‰ç«¯å®ç°è¦ç‚¹

### å®¡æ‰¹æµç±»å‹é¡µé¢

**è·¯ç”±**: `approval_flow_type`

**ç­›é€‰åŒº**:
- IDè¾“å…¥æ¡†ï¼ˆç²¾å‡†æœç´¢ï¼‰
- ç±»å‹åç§°ä¸‹æ‹‰æ¡†ï¼ˆç²¾å‡†æœç´¢ï¼Œå–æ•°æ®åº“ä¸­çš„nameï¼‰
- çŠ¶æ€ä¸‹æ‹‰æ¡†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

**åˆ—è¡¨åŒº**:
- åˆ—ï¼šidã€åç§°ã€çŠ¶æ€
- æ“ä½œï¼š
  - å¯ç”¨ï¼šä»…å½“status=1æ—¶æ˜¾ç¤º
  - ç¦ç”¨ï¼šä»…å½“status=0æ—¶æ˜¾ç¤º
- åˆ†é¡µï¼šæ¯é¡µ10æ¡

### å®¡æ‰¹æµæ¨¡æ¿é¡µé¢

**è·¯ç”±**: `approval_flow_template`

**ç­›é€‰åŒº**:
- IDè¾“å…¥æ¡†ï¼ˆç²¾å‡†æœç´¢ï¼‰
- å®¡æ‰¹æµç±»å‹ä¸‹æ‹‰æ¡†ï¼ˆå–å¯ç”¨çš„ç±»å‹ï¼‰
- æ¨¡æ¿åç§°è¾“å…¥æ¡†ï¼ˆæ¨¡ç³Šæœç´¢ï¼‰
- çŠ¶æ€ä¸‹æ‹‰æ¡†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

**åˆ—è¡¨åŒº**:
- åˆ—ï¼šidã€å®¡æ‰¹æµç±»å‹ã€æ¨¡æ¿åç§°ã€åˆ›å»ºäººã€åˆ›å»ºæ—¶é—´ã€çŠ¶æ€
- æ“ä½œï¼š
  - å¯ç”¨ï¼šä»…å½“status=1æ—¶æ˜¾ç¤ºï¼Œå¯ç”¨æ—¶ä¼šè‡ªåŠ¨ç¦ç”¨åŒç±»å‹å…¶ä»–æ¨¡æ¿
  - ç¦ç”¨ï¼šä»…å½“status=0æ—¶æ˜¾ç¤º
- åˆ†é¡µï¼šæ¯é¡µ10æ¡

**æ–°å¢å®¡æ‰¹æµæ¨¡æ¿å¼¹çª—**:
- ä»å³ä¾§æ‹‰å‡ºï¼ˆdraweræ ·å¼ï¼‰
- å†…å®¹ï¼š
  1. æ¨¡æ¿åç§°ï¼ˆå¿…å¡«ï¼‰
  2. å®¡æ‰¹æµç±»å‹ä¸‹æ‹‰æ¡†ï¼ˆå–å¯ç”¨çš„ç±»å‹ï¼‰
  3. æµç¨‹è®¾ç½®ï¼ˆå¯é€’å½’æ·»åŠ èŠ‚ç‚¹ï¼‰ï¼š
     - èŠ‚ç‚¹åç§°
     - å®¡æ‰¹ç±»å‹ï¼ˆä¼šç­¾/æˆ–ç­¾ï¼‰
     - å®¡æ‰¹äººå‘˜ï¼ˆå¯æ·»åŠ /åˆ é™¤å¤šä¸ªï¼‰
     - èŠ‚ç‚¹å¯æ·»åŠ /åˆ é™¤ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰
  4. æŠ„é€äººå‘˜ï¼ˆå¯æ·»åŠ /åˆ é™¤å¤šä¸ªï¼Œå¯ä¸ºç©ºï¼‰

**æ•°æ®ç»“æ„ç¤ºä¾‹**:
```javascript
addApprovalFlowTemplateData: {
  name: '',
  approval_flow_type_id: '',
  nodes: [
    {
      name: '',
      type: 0,  // 0-ä¼šç­¾ï¼Œ1-æˆ–ç­¾
      approvers: ['']  // å®¡æ‰¹äººå‘˜IDæ•°ç»„
    }
  ],
  copy_users: []  // æŠ„é€äººå‘˜IDæ•°ç»„
}
```

## å®‰è£…æ­¥éª¤

### 1. åˆ›å»ºæ•°æ®åº“è¡¨
```bash
mysql -h localhost -u root -p zhixinstudentsaas < create_approval_flow_tables.sql
```

### 2. æ·»åŠ èœå•é¡¹
```bash
mysql -h localhost -u root -p zhixinstudentsaas < add_approval_flow_menu.sql
```

### 3. é‡å¯åç«¯æœåŠ¡
ç¡®ä¿åç«¯åŠ è½½æœ€æ–°ä»£ç 

### 4. åˆ·æ–°å‰ç«¯
åœ¨æµè§ˆå™¨ä¸­å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰

## å¼€å‘çŠ¶æ€

**å·²å®Œæˆ**:
- âœ… æ•°æ®åº“è¡¨è®¾è®¡
- âœ… SQLè„šæœ¬åˆ›å»º
- âœ… åç«¯APIå…¨éƒ¨å®ç°
- âœ… å‰ç«¯æ•°æ®ç»“æ„å®šä¹‰
- âœ… åˆ†é¡µè®¡ç®—å±æ€§

**è¿›è¡Œä¸­**:
- ğŸ”„ å®¡æ‰¹æµç±»å‹é¡µé¢HTML
- ğŸ”„ å®¡æ‰¹æµæ¨¡æ¿é¡µé¢HTML
- ğŸ”„ æ–°å¢å®¡æ‰¹æµæ¨¡æ¿å¼¹çª—
- ğŸ”„ å‰ç«¯æ–¹æ³•å®ç°

**å¾…å®Œæˆ**:
- â³ èœå•é¡¹æ·»åŠ ï¼ˆéœ€æ‰§è¡ŒSQLï¼‰
- â³ ç«¯åˆ°ç«¯æµ‹è¯•

---

**åˆ›å»ºæ—¥æœŸ**: 2026-01-14
**æ¨¡å—ç‰ˆæœ¬**: 1.0
